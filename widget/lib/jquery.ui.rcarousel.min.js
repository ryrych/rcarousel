(function($){$.widget("ui.rcarousel",{_create:function(){var data,$root=$(this.element),_self=this,options=this.options;this._checkOptionsValidity(this.options);this._createDataObject();data=$root.data("data");$root.addClass("ui-carousel").children().wrapAll("<div class='wrapper'></div>");this._saveElements();this._generatePages();this._loadElements();this._setCarouselWidth();this._setCarouselHeight();$(options.navigation.next).click(function(event){_self.next();event.preventDefault()});$(options.navigation.prev).click(function(event){_self.prev();
event.preventDefault()});data.navigation.next=$(options.navigation.next);data.navigation.prev=$(options.navigation.prev);$root.hover(function(){if(options.auto.enabled){clearInterval(data.interval);data.hoveredOver=true}},function(){if(options.auto.enabled){data.hoveredOver=false;_self._autoMode(options.auto.direction)}});this._setStep();if(options.auto.enabled)this._autoMode(options.auto.direction);this._trigger("start")},_addElement:function(jQueryElement,direction){var $root=$(this.element),$content=
$root.find("div.wrapper"),options=this.options;jQueryElement.width(options.width).height(options.height);if(options.orientation==="horizontal")$(jQueryElement).css("marginRight",options.margin);else $(jQueryElement).css({marginBottom:options.margin,"float":"none"});if(direction==="prev")$content.prepend(jQueryElement.clone(true,true));else $content.append(jQueryElement.clone(true,true))},append:function(jqElements){var $root=$(this.element),data=$root.data("data");jqElements.each(function(i,el){data.paths.push($(el))});
data.oldPage=data.pages[data.oldPageIndex].slice(0);data.appended=true;this._generatePages()},_autoMode:function(direction){var options=this.options,data=$(this.element).data("data");if(direction==="next")data.interval=setTimeout($.proxy(this.next,this),options.auto.interval);else data.interval=setTimeout($.proxy(this.prev,this),options.auto.interval)},_checkOptionsValidity:function(options){var i,self=this,_correctSteps="";$.each(options,function(key,value){switch(key){case "visible":if(!value||
typeof value!=="number"||value<=0||Math.ceil(value)-value>0)throw new Error("visible should be defined as a positive integer");break;case "step":if(!value||typeof value!=="number"||value<=0||Math.ceil(value)-value>0)throw new Error("step should be defined as a positive integer");else if(value>self.options.visible){for(i=1;i<=Math.floor(options.visible);i++)_correctSteps+=i<Math.floor(value)?i+", ":i;throw new Error("Only following step values are correct: "+_correctSteps);}break;case "width":if(!value||
typeof value!=="number"||value<=0||Math.ceil(value)-value>0)throw new Error("width should be defined as a positive integer");break;case "height":if(!value||typeof value!=="number"||value<=0||Math.ceil(value)-value>0)throw new Error("height should be defined as a positive integer");break;case "speed":if(!value&&value!==0)throw new Error("speed should be defined as a number or a string");if(typeof value==="number"&&value<0)throw new Error("speed should be a positive number");else if(typeof value===
"string"&&!(value==="slow"||value==="normal"||value==="fast"))throw new Error('Only "slow", "normal" and "fast" values are valid');break;case "navigation":if(!value||$.isPlainObject(value)===false)throw new Error("navigation should be defined as an object with at least one of the properties: 'prev' or 'next' in it");if(value.prev&&typeof value.prev!=="string")throw new Error("navigation.prev should be defined as a string and point to '.class' or '#id' of an element");if(value.next&&typeof value.next!==
"string")throw new Error(" navigation.next should be defined as a string and point to '.class' or '#id' of an element");break;case "auto":if(typeof value.direction!=="string")throw new Error("direction should be defined as a string");if(!(value.direction==="next"||value.direction==="prev"))throw new Error("direction: only 'right' and 'left' values are valid");if(isNaN(value.interval)||typeof value.interval!=="number"||value.interval<0||Math.ceil(value.interval)-value.interval>0)throw new Error("interval should be a positive number");
break;case "auto":case "margin":if(isNaN(value)||typeof value!=="number"||value<0||Math.ceil(value)-value>0)throw new Error("margin should be a positive number");break}})},_createDataObject:function(){var $root=$(this.element);$root.data("data",{paths:[],pathsLen:0,pages:[],lastPage:[],oldPageIndex:0,pageIndex:0,navigation:{},animated:false,appended:false,hoveredOver:false})},_generatePages:function(){var self=this,options=this.options,data=$(this.element).data("data"),_visible=options.visible,_step=
options.step,_pathsLen=data.paths.length;function _init(){data.pages=[];data.lastPage=[];data.pages[0]=[];if(options.seamless.enabled&&options.seamless.repeatElements)for(var i=_visible-(_step+1);i>=-_step;i--)data.lastPage.unshift(data.paths[(_pathsLen+i)%_pathsLen]);else if(options.seamless.enabled&&!options.seamless.repeatElements){var _lastElement=_pathsLen-_pathsLen%_step-1;for(var i=_lastElement;i>_lastElement-_visible;i--)data.lastPage.unshift(data.paths[i])}else for(var i=_pathsLen-1;i>=_pathsLen-
_visible;i--)data.lastPage.unshift(data.paths[i]);for(var i=0;i<_visible;i++)data.pages[0][data.pages[0].length]=data.paths[i]}function _islastPage(page){var _isLast=false;for(var i=0;i<data.lastPage.length;i++)if(data.lastPage[i].get(0)===page[i].get(0))_isLast=true;else{_isLast=false;break}return _isLast}function _paginate(seamless){var _isBeginning=true,_start=0,_index;while(!_islastPage(data.pages[data.pages.length-1])||_isBeginning){_isBeginning=false;_index=data.pages.length;data.pages[_index]=
[];_start+=_step;if(options.seamless.enabled||data.pages.length*_visible<_pathsLen)for(var i=_start;i<_start+_visible;i++)data.pages[_index].push(data.paths[i%_pathsLen]);else for(var i=_visible;i>0;i--)data.pages[_index].push(data.paths[_pathsLen-i])}}_init();_paginate()},getCurrentPage:function(){var data=$(this.element).data("data");return data.pageIndex+1},getTotalPages:function(){var data=$(this.element).data("data");return data.pages.length},goToPage:function(page){var _by,data=$(this.element).data("data");
if(!data.animated&&page!==data.pageIndex){data.animated=true;if(page>data.pages.length-1)page=data.pages.length-1;else if(page<0)page=0;data.pageIndex=page;_by=page-data.oldPageIndex;if(_by>=0)this._goToNextPage(_by);else this._goToPrevPage(_by);data.oldPageIndex=page}},_loadElements:function(elements,direction){var options=this.options,data=$(this.element).data("data"),_dir=direction||"next",_elem=elements||data.pages[options.startAtPage],_start=0,_end=_elem.length;if(_dir==="next")for(var i=_start;i<
_end;i++)this._addElement(_elem[i],_dir);else for(var i=_end-1;i>=_start;i--)this._addElement(_elem[i],_dir)},_goToPrevPage:function(by){var _page,_oldPage,_dist,_index,_animOpts,$lastEl,_unique,_pos,_theSame,$root=$(this.element),self=this,options=this.options,data=$(this.element).data("data");if(data.appended)_oldPage=data.oldPage;else _oldPage=data.pages[data.oldPageIndex];_index=data.oldPageIndex+by;_page=data.pages[_index].slice(0);$(_page).each(function(i,el){if(el.get(0)===$(_oldPage[i]).get(0))_theSame=
true;else _theSame=false});if(data.appended&&_theSame){if(data.pageIndex===0)_index=data.pageIndex=data.pages.length-1;else _index=--data.pageIndex;_page=data.pages[_index].slice(0)}$lastEl=_page[_page.length-1].get(0);for(var i=_oldPage.length-1;i>=0;i--)if($lastEl===$(_oldPage[i]).get(0)){_unique=false;_pos=i;break}else _unique=true;if(!_unique)while(_pos>=0){if(_page[_page.length-1].get(0)===_oldPage[_pos].get(0))_page.pop();--_pos}self._loadElements(_page,"prev");_dist=options.width*_page.length+
options.margin*_page.length;if(options.orientation==="horizontal"){_animOpts={scrollLeft:0};$root.scrollLeft(_dist)}else{_animOpts={scrollTop:0};$root.scrollTop(_dist)}$root.animate(_animOpts,options.speed,function(){self._removeOldElements("last",_page.length);data.animated=false;if(!data.hoveredOver&&options.auto.enabled){clearInterval(data.interval);self._autoMode(options.auto.direction)}self._trigger("pageLoaded",null,{page:_index})});data.appended=false},_goToNextPage:function(by){var _page,
_oldPage,_dist,_index,_animOpts,$firstEl,_unique,_pos,_theSame,$root=$(this.element),options=this.options,data=$root.data("data"),self=this;if(data.appended)_oldPage=data.oldPage;else _oldPage=data.pages[data.oldPageIndex];_index=data.oldPageIndex+by;_page=data.pages[_index].slice(0);$(_page).each(function(i,el){if(el.get(0)===$(_oldPage[i]).get(0))_theSame=true;else _theSame=false});if(data.appended&&_theSame)_page=data.pages[++data.pageIndex].slice(0);$firstEl=_page[0].get(0);for(var i=0;i<_page.length;i++)if($firstEl===
$(_oldPage[i]).get(0)){_unique=false;_pos=i;break}else _unique=true;if(!_unique)while(_pos<_oldPage.length){if(_page[0].get(0)===_oldPage[_pos].get(0))_page.shift();++_pos}this._loadElements(_page,"next");_dist=options.width*_page.length+options.margin*_page.length;if(options.orientation==="horizontal")_animOpts={scrollLeft:"+="+_dist};else _animOpts={scrollTop:"+="+_dist};$root.animate(_animOpts,options.speed,function(){self._removeOldElements("first",_page.length);if(options.orientation==="horizontal")$root.scrollLeft(0);
else $root.scrollTop(0);data.animated=false;if(!data.hoveredOver&&options.auto.enabled){clearInterval(data.interval);self._autoMode(options.auto.direction)}self._trigger("pageLoaded",null,{page:_index})});data.appended=false},next:function(){var options=this.options,data=$(this.element).data("data");if(!data.animated){data.animated=true;if(!data.appended)++data.pageIndex;if(data.pageIndex>data.pages.length-1)data.pageIndex=0;this._goToNextPage(data.pageIndex-data.oldPageIndex);data.oldPageIndex=data.pageIndex}},
prev:function(){var options=this.options,data=$(this.element).data("data");if(!data.animated){data.animated=true;if(!data.appended)--data.pageIndex;if(data.pageIndex<0)data.pageIndex=data.pages.length-1;this._goToPrevPage(data.pageIndex-data.oldPageIndex);data.oldPageIndex=data.pageIndex}},_removeOldElements:function(position,length){var $root=$(this.element);for(var i=0;i<length;i++)if(position==="first")$root.find("div.wrapper").children().first().remove();else $root.find("div.wrapper").children().last().remove()},
_saveElements:function(){var $el,$root=$(this.element),$elements=$root.find("div.wrapper").children(),data=$root.data("data");$elements.each(function(i,el){$el=$(el);data.paths.push($el.clone(true,true));$el.remove()})},_setOption:function(key,value){var _newOptions,options=this.options,data=$(this.element).data("data");switch(key){case "speed":this._checkOptionsValidity({speed:value});options.speed=value;$.Widget.prototype._setOption.apply(this,arguments);break;case "auto":_newOptions=$.extend(options.auto,
value);this._checkOptionsValidity({auto:_newOptions});if(options.auto.enabled)this._autoMode(options.auto.direction)}},_setStep:function(s){var _step,options=this.options,data=$(this.element).data("data");_step=s||options.step;options.step=_step;data.step=options.width*_step},_setCarouselHeight:function(){var _newHeight,$root=$(this.element),data=$(this.element).data("data"),options=this.options;if(options.orientation==="vertical")_newHeight=options.visible*options.height+options.margin*(options.visible-
1);else _newHeight=options.height;$root.height(_newHeight)},_setCarouselWidth:function(){var _newWidth,$root=$(this.element),options=this.options,data=$(this.element).data("data");if(options.orientation==="horizontal")_newWidth=options.visible*options.width+options.margin*(options.visible-1);else _newWidth=options.width;$root.css({width:_newWidth,overflow:"hidden"})},options:{visible:3,step:3,width:100,height:100,speed:1E3,margin:0,orientation:"horizontal",auto:{enabled:false,direction:"next",interval:5E3},
startAtPage:0,navigation:{next:"#ui-carousel-next",prev:"#ui-carousel-prev"},seamless:{enabled:false,repeatElements:true}}})})(jQuery);
