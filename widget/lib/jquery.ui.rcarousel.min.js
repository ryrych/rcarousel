(function(e){e.widget("ui.rcarousel",{_create:function(){var t,n=e(this.element),r=this,i=this.options;this._checkOptionsValidity(this.options);this._createDataObject();t=n.data("data");n.addClass("ui-carousel").children().wrapAll("<div class='wrapper'></div>");this._saveElements();this._generatePages();this._loadElements();this._setCarouselWidth();this._setCarouselHeight();e(i.navigation.next).click(function(e){r.next();e.preventDefault()});e(i.navigation.prev).click(function(e){r.prev();e.preventDefault()});t.navigation.next=e(i.navigation.next);t.navigation.prev=e(i.navigation.prev);n.hover(function(){if(i.auto.enabled){clearInterval(t.interval);t.hoveredOver=true}},function(){if(i.auto.enabled){t.hoveredOver=false;r._autoMode(i.auto.direction)}});this._setStep();if(i.auto.enabled){this._autoMode(i.auto.direction)}this._trigger("start")},_addElement:function(t,n){var r=e(this.element),i=r.find("div.wrapper"),s=this.options;if(!t){return}t.width(s.width).height(s.height);if(s.orientation==="horizontal"){e(t).css("marginRight",s.margin)}else{e(t).css({marginBottom:s.margin,"float":"none"})}if(n==="prev"){i.prepend(t.clone(true,true))}else{i.append(t.clone(true,true))}},append:function(t){var n=e(this.element),r=n.data("data");t.each(function(t,n){r.paths.push(e(n))});r.oldPage=r.pages[r.oldPageIndex].slice(0);r.appended=true;this._generatePages()},_autoMode:function(t){var n=this.options,r=e(this.element).data("data");if(t==="next"){r.interval=setTimeout(e.proxy(this.next,this),n.auto.interval)}else{r.interval=setTimeout(e.proxy(this.prev,this),n.auto.interval)}},_checkOptionsValidity:function(t){var n,r=this,i="";e.each(t,function(s,o){switch(s){case"visible":if(!o||typeof o!=="number"||o<=0||Math.ceil(o)-o>0){throw new Error("visible should be defined as a positive integer")}break;case"step":if(!o||typeof o!=="number"||o<=0||Math.ceil(o)-o>0){throw new Error("step should be defined as a positive integer")}else if(o>r.options.visible){for(n=1;n<=Math.floor(t.visible);n++){i+=n<Math.floor(o)?n+", ":n}throw new Error("Only following step values are correct: "+i)}break;case"width":if(!o||typeof o!=="number"||o<=0||Math.ceil(o)-o>0){throw new Error("width should be defined as a positive integer")}break;case"height":if(!o||typeof o!=="number"||o<=0||Math.ceil(o)-o>0){throw new Error("height should be defined as a positive integer")}break;case"speed":if(!o&&o!==0){throw new Error("speed should be defined as a number or a string")}if(typeof o==="number"&&o<0){throw new Error("speed should be a positive number")}else if(typeof o==="string"&&!(o==="slow"||o==="normal"||o==="fast")){throw new Error('Only "slow", "normal" and "fast" values are valid')}break;case"navigation":if(!o||e.isPlainObject(o)===false){throw new Error("navigation should be defined as an object with at least one of the properties: 'prev' or 'next' in it")}if(o.prev&&typeof o.prev!=="string"){throw new Error("navigation.prev should be defined as a string and point to '.class' or '#id' of an element")}if(o.next&&typeof o.next!=="string"){throw new Error(" navigation.next should be defined as a string and point to '.class' or '#id' of an element")}break;case"auto":if(typeof o.direction!=="string"){throw new Error("direction should be defined as a string")}if(!(o.direction==="next"||o.direction==="prev")){throw new Error("direction: only 'right' and 'left' values are valid")}if(isNaN(o.interval)||typeof o.interval!=="number"||o.interval<0||Math.ceil(o.interval)-o.interval>0){throw new Error("interval should be a positive number")}break;case"margin":if(isNaN(o)||typeof o!=="number"||o<0||Math.ceil(o)-o>0){throw new Error("margin should be a positive number")}break}})},_createDataObject:function(){var t=e(this.element);t.data("data",{paths:[],pathsLen:0,pages:[],lastPage:[],oldPageIndex:0,pageIndex:0,navigation:{},animated:false,appended:false,hoveredOver:false})},_generatePages:function(){function o(){r.pages=[];r.lastPage=[];r.pages[0]=[];for(var e=s-1;e>=s-i;e--){r.lastPage.unshift(r.paths[e])}for(var e=0;e<i;e++){r.pages[0][r.pages[0].length]=r.paths[e]}}function u(e){var t=false;for(var n=0;n<r.lastPage.length;n++){if(!r.lastPage[n]||!e[n]||r.lastPage[n].get(0)===e[n].get(0)){t=true}else{t=false;break}}return t}function a(e,t,n){var i=n||r.pages.length;if(!n){r.pages[i]=[]}for(var s=e;s<t;s++){r.pages[i].push(r.paths[s])}return i}function f(){var e=true,t=false,o=n.step,f,l,c,h;while(!u(r.pages[r.pages.length-1])||e){e=false;f=o+i;if(f>s){f=s}if(f-o<i){t=true}else{t=false}if(t){c=o-(i-(f-o));h=c+(i-(f-o));l=a(c,h);a(o,f,l)}else{a(o,f);o+=n.step}}}var t=this,n=this.options,r=e(this.element).data("data"),i=n.visible,s=r.paths.length;o();f()},getCurrentPage:function(){var t=e(this.element).data("data");return t.pageIndex+1},getTotalPages:function(){var t=e(this.element).data("data");return t.pages.length},goToPage:function(t){var n,r=e(this.element).data("data");if(!r.animated&&t!==r.pageIndex){r.animated=true;if(t>r.pages.length-1){t=r.pages.length-1}else if(t<0){t=0}r.pageIndex=t;n=t-r.oldPageIndex;if(n>=0){this._goToNextPage(n)}else{this._goToPrevPage(n)}r.oldPageIndex=t}},_loadElements:function(t,n){var r=this.options,i=e(this.element).data("data"),s=n||"next",o=t||i.pages[r.startAtPage],u=0,a=o.length;if(s==="next"){for(var f=u;f<a;f++){this._addElement(o[f],s)}}else{for(var f=a-1;f>=u;f--){this._addElement(o[f],s)}}},_goToPrevPage:function(t){var n,r,i,s,o,u,a,f,l,c=e(this.element),h=this,p=this.options,d=e(this.element).data("data");if(d.appended){r=d.oldPage}else{r=d.pages[d.oldPageIndex]}s=d.oldPageIndex+t;n=d.pages[s].slice(0);e(n).each(function(t,n){if(n.get(0)===e(r[t]).get(0)){l=true}else{l=false}});if(d.appended&&l){if(d.pageIndex===0){s=d.pageIndex=d.pages.length-1}else{s=--d.pageIndex}n=d.pages[s].slice(0)}u=n[n.length-1].get(0);for(var v=r.length-1;v>=0;v--){if(u===e(r[v]).get(0)){a=false;f=v;break}else{a=true}}if(!a){while(f>=0){if(n[n.length-1].get(0)===r[f].get(0)){n.pop()}--f}}h._loadElements(n,"prev");i=p.width*n.length+p.margin*n.length;if(p.orientation==="horizontal"){o={scrollLeft:0};c.scrollLeft(i)}else{o={scrollTop:0};c.scrollTop(i)}c.animate(o,p.speed,function(){h._removeOldElements("last",n.length);d.animated=false;if(!d.hoveredOver&&p.auto.enabled){clearInterval(d.interval);h._autoMode(p.auto.direction)}h._trigger("pageLoaded",null,{page:s})});d.appended=false},_goToNextPage:function(t){var n,r,i,s,o,u,a,f,l,c=e(this.element),h=this.options,p=c.data("data"),d=this;if(p.appended){r=p.oldPage}else{r=p.pages[p.oldPageIndex]}s=p.oldPageIndex+t;n=p.pages[s].slice(0);e(n).each(function(t,n){if(n.get(0)===e(r[t]).get(0)){l=true}else{l=false}});if(p.appended&&l){n=p.pages[++p.pageIndex].slice(0)}u=n[0].get(0);for(var v=0;v<n.length;v++){if(u===e(r[v]).get(0)){a=false;f=v;break}else{a=true}}if(!a){while(f<r.length){if(n[0].get(0)===r[f].get(0)){n.shift()}++f}}this._loadElements(n,"next");i=h.width*n.length+h.margin*n.length;if(h.orientation==="horizontal"){o={scrollLeft:"+="+i}}else{o={scrollTop:"+="+i}}c.animate(o,h.speed,function(){d._removeOldElements("first",n.length);if(h.orientation==="horizontal"){c.scrollLeft(0)}else{c.scrollTop(0)}p.animated=false;if(!p.hoveredOver&&h.auto.enabled){clearInterval(p.interval);d._autoMode(h.auto.direction)}d._trigger("pageLoaded",null,{page:s})});p.appended=false},next:function(){var t=this.options,n=e(this.element).data("data");if(!n.animated){n.animated=true;if(!n.appended){++n.pageIndex}if(n.pageIndex>n.pages.length-1){n.pageIndex=0}this._goToNextPage(n.pageIndex-n.oldPageIndex);n.oldPageIndex=n.pageIndex}},prev:function(){var t=this.options,n=e(this.element).data("data");if(!n.animated){n.animated=true;if(!n.appended){--n.pageIndex}if(n.pageIndex<0){n.pageIndex=n.pages.length-1}this._goToPrevPage(n.pageIndex-n.oldPageIndex);n.oldPageIndex=n.pageIndex}},_removeOldElements:function(t,n){var r=e(this.element);for(var i=0;i<n;i++){if(t==="first"){r.find("div.wrapper").children().first().remove()}else{r.find("div.wrapper").children().last().remove()}}},_saveElements:function(){var t,n=e(this.element),r=n.find("div.wrapper").children(),i=n.data("data");r.each(function(n,r){t=e(r);i.paths.push(t.clone(true,true));t.remove()})},_setOption:function(t,n){var r,i=this.options,s=e(this.element).data("data");switch(t){case"speed":this._checkOptionsValidity({speed:n});i.speed=n;e.Widget.prototype._setOption.apply(this,arguments);break;case"auto":r=e.extend(i.auto,n);this._checkOptionsValidity({auto:r});if(i.auto.enabled){this._autoMode(i.auto.direction)}}},_setStep:function(t){var n,r=this.options,i=e(this.element).data("data");n=t||r.step;r.step=n;i.step=r.width*n},_setCarouselHeight:function(){var t,n=e(this.element),r=e(this.element).data("data"),i=this.options;if(i.orientation==="vertical"){t=i.visible*i.height+i.margin*(i.visible-1)}else{t=i.height}n.height(t)},_setCarouselWidth:function(){var t,n=e(this.element),r=this.options,i=e(this.element).data("data");if(r.orientation==="horizontal"){t=r.visible*r.width+r.margin*(r.visible-1)}else{t=r.width}n.css({width:t,overflow:"hidden"})},options:{visible:3,step:3,width:100,height:100,speed:1e3,margin:0,orientation:"horizontal",auto:{enabled:false,direction:"next",interval:5e3},startAtPage:0,navigation:{next:"#ui-carousel-next",prev:"#ui-carousel-prev"}}})})(jQuery)